<!doctype html><html lang=en-us dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Authentication in Azure Schema Operator #  Azure Schema Operator supports two different styles of authentication today.
 managed identity (via aad-pod-identity authentication) Service Principal  Managed Identity (aad-pod-identity) #  Prerequisites #   An existing Azure Managed Identity. aad-pod-identity installed into your cluster. If you are running ASO on an Azure Kubernetes Service (AKS) cluster, you can instead use the integrated aad-pod-identity.  First, set the following environment variables:">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content>
<meta property="og:description" content="Authentication in Azure Schema Operator #  Azure Schema Operator supports two different styles of authentication today.
 managed identity (via aad-pod-identity authentication) Service Principal  Managed Identity (aad-pod-identity) #  Prerequisites #   An existing Azure Managed Identity. aad-pod-identity installed into your cluster. If you are running ASO on an Azure Kubernetes Service (AKS) cluster, you can instead use the integrated aad-pod-identity.  First, set the following environment variables:">
<meta property="og:type" content="article">
<meta property="og:url" content="https://microsoft.github.io/azure-schema-operator/introduction/authentication/"><meta property="article:section" content="introduction">
<title>Authentication | Azure Schema Operator</title>
<link rel=manifest href=/azure-schema-operator/manifest.json>
<link rel=icon href=/azure-schema-operator/favicon.png type=image/x-icon>
<link rel=stylesheet href=/azure-schema-operator/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css integrity="sha256-gsXb0jRHzuC0wqo+0Izglh+qQOH6Nw7uT4yfAuDUa18=" crossorigin=anonymous>
<script defer src=/azure-schema-operator/flexsearch.min.js></script>
<script defer src=/azure-schema-operator/en.search.min.5c173f1e5ef11931528a30894e29a388387170569b59171079abda767d90e16b.js integrity="sha256-XBc/Hl7xGTFSijCJTimjiDhxcFabWRcQeavadn2Q4Ws=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/azure-schema-operator/><span>Azure Schema Operator</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<span>Userâ€™s Guide</span>
<ul>
<li>
<a href=/azure-schema-operator/introduction/install/>Installation Guide</a>
</li>
<li>
<a href=/azure-schema-operator/introduction/helm-docs/>Helm Docs</a>
</li>
<li>
<a href=/azure-schema-operator/introduction/annotations/>Annotations</a>
</li>
<li>
<a href=/azure-schema-operator/introduction/authentication/ class=active>Authentication</a>
</li>
<li>
<a href=/azure-schema-operator/introduction/configuration/>Configuration</a>
</li>
<li>
<a href=/azure-schema-operator/introduction/events_and_conditions/>Events and Conditions</a>
</li>
<li>
<a href=/azure-schema-operator/introduction/filter/>Filter</a>
</li>
<li>
<a href=/azure-schema-operator/introduction/plugin_installation/>Plugin Installation</a>
</li>
</ul>
</li>
<li>
<span>For Contributors</span>
<ul>
<li>
<a href=/azure-schema-operator/contributing/contributing/>Contributing</a>
</li>
<li>
<a href=/azure-schema-operator/contributing/create-a-new-release/>Create a New Release</a>
</li>
<li>
<a href=/azure-schema-operator/contributing/documentation/>Documentation</a>
</li>
</ul>
</li>
<li>
<span>Tutorials</span>
<ul>
<li>
<a href=/azure-schema-operator/tutorials/eventhub/>Eventhub</a>
</li>
<li>
<a href=/azure-schema-operator/tutorials/kusto/>Kusto</a>
</li>
<li>
<a href=/azure-schema-operator/tutorials/sqlserver/>Sqlserver</a>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/azure-schema-operator/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Authentication</strong>
<label for=toc-control>
<img src=/azure-schema-operator/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#managed-identity-aad-pod-identity>Managed Identity (aad-pod-identity)</a>
<ul>
<li><a href=#prerequisites>Prerequisites</a></li>
</ul>
</li>
<li><a href=#service-principal>Service Principal</a>
<ul>
<li><a href=#prerequisites-1>Prerequisites</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown><h1 id=authentication-in-azure-schema-operator>
Authentication in Azure Schema Operator
<a class=anchor href=#authentication-in-azure-schema-operator>#</a>
</h1>
<p>Azure Schema Operator supports two different styles of authentication today.</p>
<ol>
<li>managed identity (via aad-pod-identity authentication)</li>
<li>Service Principal</li>
</ol>
<h2 id=managed-identity-aad-pod-identity>
Managed Identity (aad-pod-identity)
<a class=anchor href=#managed-identity-aad-pod-identity>#</a>
</h2>
<h3 id=prerequisites>
Prerequisites
<a class=anchor href=#prerequisites>#</a>
</h3>
<ol>
<li>An existing Azure Managed Identity.</li>
<li><a href=https://github.com/Azure/aad-pod-identity>aad-pod-identity</a> installed into your cluster. If you are running ASO on an Azure Kubernetes Service (AKS) cluster, you can instead use the
<a href=https://docs.microsoft.com/azure/aks/use-azure-ad-pod-identity>integrated aad-pod-identity</a>.</li>
</ol>
<p>First, set the following environment variables:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>export IDENTITY_RESOURCE_GROUP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;myrg&#34;</span>                              <span style=color:#75715e># The resource group containing the managed identity.</span>
export IDENTITY_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;myidentity&#34;</span>                                  <span style=color:#75715e># The name of the identity.</span>
export AZURE_SUBSCRIPTION_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;00000000-0000-0000-0000-00000000000&#34;</span> <span style=color:#75715e># The Azure Subscription ID the identity is in.</span>
export AZURE_TENANT_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;00000000-0000-0000-0000-00000000000&#34;</span>       <span style=color:#75715e># The Azure AAD Tenant the identity/subscription is associated with.</span>
</code></pre></div><p>Use the <code>az cli</code> to get some more details about the identity to use:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>export IDENTITY_CLIENT_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>az identity show -g <span style=color:#e6db74>${</span>IDENTITY_RESOURCE_GROUP<span style=color:#e6db74>}</span> -n <span style=color:#e6db74>${</span>IDENTITY_NAME<span style=color:#e6db74>}</span> --query clientId -otsv<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
export IDENTITY_RESOURCE_ID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>az identity show -g <span style=color:#e6db74>${</span>IDENTITY_RESOURCE_GROUP<span style=color:#e6db74>}</span> -n <span style=color:#e6db74>${</span>IDENTITY_NAME<span style=color:#e6db74>}</span> --query id -otsv<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><p>Deploy an <code>AzureIdentity</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat <span style=color:#e6db74>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#e6db74>apiVersion: &#34;aadpodidentity.k8s.io/v1&#34;
</span><span style=color:#e6db74>kind: AzureIdentity
</span><span style=color:#e6db74>metadata:
</span><span style=color:#e6db74>  name: azureschemaoperator-identity
</span><span style=color:#e6db74>  namespace: azureschemaoperator-system
</span><span style=color:#e6db74>spec:
</span><span style=color:#e6db74>  type: 0
</span><span style=color:#e6db74>  resourceID: ${IDENTITY_RESOURCE_ID}
</span><span style=color:#e6db74>  clientID: ${IDENTITY_CLIENT_ID}
</span><span style=color:#e6db74>EOF</span>
</code></pre></div><p>Deploy an <code>AzureIdentityBinding</code> to bind this identity to the Azure Schema Operator manager pod:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat <span style=color:#e6db74>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#e6db74>apiVersion: &#34;aadpodidentity.k8s.io/v1&#34;
</span><span style=color:#e6db74>kind: AzureIdentityBinding
</span><span style=color:#e6db74>metadata:
</span><span style=color:#e6db74>  name: azureschemaoperator-identity-binding
</span><span style=color:#e6db74>  namespace: azureschemaoperator-system
</span><span style=color:#e6db74>spec:
</span><span style=color:#e6db74>  azureIdentity: azureschemaoperator-identity
</span><span style=color:#e6db74>  selector: azureschemaoperator-manager-binding
</span><span style=color:#e6db74>EOF</span>
</code></pre></div><h2 id=service-principal>
Service Principal
<a class=anchor href=#service-principal>#</a>
</h2>
<h3 id=prerequisites-1>
Prerequisites
<a class=anchor href=#prerequisites-1>#</a>
</h3>
<ol>
<li>An existing Azure Service Principal.</li>
</ol>
<p>To use Service Principal authentication, specify an <code>schema-operator-controller-settings</code> secret with <code>AZURE_CLIENT_ID</code> and <code>AZURE_CLIENT_SECRET</code> set.</p>
<ul>
<li><code>AZURE_CLIENT_ID</code> must be set to the Service Principal client ID. This will be a GUID.</li>
<li><code>AZURE_CLIENT_SECRET</code> must be set to the Service Principal client secret.</li>
</ul>
<p>For more information about Service Principals, see <a href=https://docs.microsoft.com/cli/azure/create-an-azure-service-principal-azure-cli#password-based-authentication>creating an Azure Service Principal using the Azure CLI</a>.
The <code>AZURE_CLIENT_ID</code> is sometimes also called the App ID. The <code>AZURE_CLIENT_SECRET</code> is the &ldquo;password&rdquo; returned by the command in the previously linked documentation.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat <span style=color:#e6db74>&lt;&lt;EOF | kubectl apply -f -
</span><span style=color:#e6db74>apiVersion: v1
</span><span style=color:#e6db74>kind: Secret
</span><span style=color:#e6db74>metadata:
</span><span style=color:#e6db74> name: schema-operator-controller-settings
</span><span style=color:#e6db74> namespace: azureschemaoperator-system
</span><span style=color:#e6db74>stringData:
</span><span style=color:#e6db74> AZURE_TENANT_ID: &#34;$AZURE_TENANT_ID&#34;
</span><span style=color:#e6db74> AZURE_CLIENT_ID: &#34;$AZURE_CLIENT_ID&#34;
</span><span style=color:#e6db74> AZURE_CLIENT_SECRET: &#34;$AZURE_CLIENT_SECRET&#34;
</span><span style=color:#e6db74>EOF</span>
</code></pre></div><p><em>Note</em> - When deploying the schema operator via the <a href=charts/azure-schema-operator>helm chart</a>
the secret can be generated by passing <code>createAzureOperatorSecret: true</code> to the <code>Values.yaml</code>.</p>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#managed-identity-aad-pod-identity>Managed Identity (aad-pod-identity)</a>
<ul>
<li><a href=#prerequisites>Prerequisites</a></li>
</ul>
</li>
<li><a href=#service-principal>Service Principal</a>
<ul>
<li><a href=#prerequisites-1>Prerequisites</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>